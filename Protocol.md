# Surviveler protocol

The surviveler protocol is based on TCP transport.

## General packet structure

The following one is the general structure of the surviveler protocol structure
both in client->server communication and in server->client communication.

    +---------+
    | msgtype |
    +---------+
    | size    |
    +---------+
    | payload |
    +---------+

 * **msgtype** (2 bytes unsigned short): the type of the message: a
 comprehensive list of msgtypes is available in client/src/message.py
 (MessageType enum) in network-byte-order.

 * **size** (4 bytes unsigned int): the size in bytes of the payload in
 network-byte-order.

 * **payload** (N bytes): the msgpack-encoded message payload containing the
 whole information needed for the message (examples below).

## Message types

### Ping

The **ping** message type (type *0*) is used (along with the **pong**) to sync
the client time with the server one. After a sync, the client in able to
calculate on his own how to interpret the *state* data received from the server
regardless of eventual lags or huge ping time.

*This message is only generated by the client.*

The **ping** payload contains the following data:

    {
        "id": 1234
    }

 * **id** (number) is an incremental number generated by the client and used by
 it to ideitify the **pong** response from the server (in case of multiple
 *ping* requests)

### Pong

The **pong** message type (type *1*) is used (along with the **ping**) to sync
the client time with the server one. After a sync, the client in able to
calculate on his own how to interpret the *state* data received from the server
regardless of eventual lags or huge ping time.

*This message is only generated by the server.*

The **ping** payload contains the following data:

    {
        "id": 1234,
        "tstamp": 12345678
    }

 * **id** (number) is an incremental number generated by the client and used by
 it to ideitify the **pong** response from the server (in case of multiple
 *ping* requests)

 * **tstamp** (number) in his current acception is the number of milliseconds
 after epoch calculated on the server (UTC). We use this just to create the
 timedelta inside the client and sync the operations so it can be relative from
 whatever reference time available from the server (*like when the server
 started his execution*).
